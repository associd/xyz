<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <meta http-equiv="X-UA-Compatible" content="ie=edge">
   <link rel="stylesheet" href="style.css">
   <link rel="stylesheet" href="scoreboard.css">
   <link rel="stylesheet" href="controlboard.css">
   <link rel="stylesheet" href="oil-gauge.css">
   <link rel="stylesheet" href="cloud.css">
   <link rel="stylesheet" href="bird.css">
   <link rel="stylesheet" href="ranking.css">
   <title>airWar</title>
</head>
<body>
   <div id="gameDom" class="p-center">
      <div id="screen" class="screen-box">
         <div class="title-screen screen">
            <img src="./img/SkyAngel.png" alt="" id="logo-1">
            <button id="gameStart" class="btn">开始游戏</button>
         </div>
         <div class="play-screen screen">
            <div class="game-top board flex flex-align-center">
               <div class="content-1 flex flex-align-center">
                  <div id="oil-gauge">
                     <div class="oil-energy"><img class="oil-cover" src="./img/gas_2.png"></div>
                  </div>
               </div>
               <div class="logo-2"></div>
               <div class="scoreAndcontrol-board board flex flex-align-center">
                  <div id="star-counter">
                     <table>
                        <tbody>
                           <tr>
                              <td id="star-icon"></td>
                              <td id="star-counter-value">0</td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
                  <div id="game-time"><span id="time-m">00</span>:<span id="time-s">00</span></div>
                  <div id="text-font-size" class="flex flex-align-center">
                     <div id="text-increase" class="btn">A+</div>
                     <div id="text-decrease" class="btn">A-</div>
                  </div>
                  <div id="game-status" class="btn">
                     <img id="game-pause" class="" src="./img/pause-middle.png" alt="">
                     <img id="game-play" class="display-none" src="./img/play-middle.png" alt="">
                  </div>
                  <div id="bgm" class="btn">
                     <audio id="bgm-source" src="./sound/background.mp3"></audio>
                  </div>
               </div>
            </div>
            <div class="game-content">
               <div id="airPlane">
                  <img src="./img/airPlane_2.png" alt="">
               </div>

               <img src="./img/cloud_1.png" alt="" id="cloud-1" class="cloud">
               <img src="./img/cloud_2.png" alt="" id="cloud-2" class="cloud">
               <img src="./img/cloud_3.png" alt="" id="cloud-3" class="cloud">

               <img src="./img/star_gold_256.png" id="star" alt="">

               <div id="bird-a"></div>

               <div class="supply"></div>
            </div>
         </div>
         <div class="gameover-screen screen active">
            <div id="ranking">
               <div class="logo-2 ranking-logo"></div>
               <table class="ranking-content">
                  <thead>
                     <tr>
                        <th>name</th>
                        <th>time</th>
                        <th>star</th>
                     </tr>
                  </thead>
                  <tr class="record">
                     <td class="record-name">sdfsdfs</td>
                     <td class="record-time">21321</td>
                     <td class="record-star">66655</td>
                  </tr>
                  <tr class="record">
                     <td class="record-name">sdfsdfs</td>
                     <td class="record-time">21321</td>
                     <td class="record-star">66655</td>
                  </tr>
                  <tr class="record">
                     <td class="record-name">sdfsdfs</td>
                     <td class="record-time">21321</td>
                     <td class="record-star">66655</td>
                  </tr>
               </table>
            </div>
            <div><button id="restart" class="btn restart">restart</button></div>
         </div>
      </div>
   </div>
   <script>
      var e = sel => document.querySelector(sel);
      var es = sel => document.querySelectorAll(sel);
      var log = console.log.bind(console);

      (function() {

         var airPlane = createAirPlane();

         //保存众多游戏元素
         var game = {
            dom: e("#gameDom"),
            keyDown: {},         //保存按键状态
            status: "stop",
            elements: [airPlane],
         }
         game.getWidth = function() {
            return game.dom.offsetWidth;
         }
         game.getHeight = function() {
            return game.dom.offsetHeight;
         }
         game.update = function() {
            game.elements.forEach(item => {
               item.update(game)
            })
         }

         // 鼠标点击相应的按钮会触发相应的事件
         var clickAction = {
            gameStart: function(event) {
               e(".play-screen").classList.add("active")
               e(".title-screen").classList.remove("active")
               playGame(game);
            },
            restart: function(event){
               location.reload()
            }
         }


         document.addEventListener("keydown", event => {
            if(hasStarted(game)){
               game.keyDown[event.key] = true;
            }
         })
         document.addEventListener("keyup", event => {
               game.keyDown[event.key] = false;
         })
         document.addEventListener("click", event => {
            if(clickAction[event.target.id]){
               clickAction[event.target.id](event);
            }
         })
         function hasStarted(game) {
            return game.status;
         }
      })()

      function gameover(game){
         game.status = "over"
      }
      function playGame(game) {
         game.status = "start";
         refresh(game);
         es(".cloud").forEach(item => {
            item.classList.add("move")
         })
      }
      function refresh(game) {
         setTimeout(() => {
            game.update(game);
            refresh(game);
         }, 1000 / 60)
      }
      function createAirPlane() {
         var o = {};
         o.dom = e("#airPlane");
         o.getWidth = function() {
            return o.dom.offsetWidth;
         }
         o.getHeight = function() {
            return o.dom.offsetHeight;
         }
         o.setX = function(x) {
            this.dom.style.left = `${x}px`;
         }
         o.getX = function() {
            return o.dom.offsetLeft;
         }
         o.setY = function(y) {
            this.dom.style.top = `${y}px`;
         }
         o.getY = function() {
            return o.dom.offsetTop;
         }
         o.speed = {
            x: 10,
            y: 10,
         }
         o.action = {
            ArrowUp: (game) => {
               var y = o.getY() - o.speed.y
               o.setY( y <= 0 ? 0 : y);
            },
            ArrowDown: (game) => {
               var y = o.getY() + o.speed.y
               o.setY( y+o.getHeight() >= game.getHeight() ? game.getHeight()-o.getHeight() : y);
            },
            ArrowLeft: (game) => {
               var x = o.getX() - o.speed.x
               o.setX( x <= 0 ? 0 : x);
            },
            ArrowRight: (game) => {
               var x = o.getX() + o.speed.x
               o.setX( x+o.getWidth() >= game.getWidth() ? game.getWidth()-o.getWidth() : x);
            },
         }
         o.move = function(direction, wraper) {
            o.action[direction](wraper);
         }
         o.update = function(game) {
            //按键事件
            Object.keys(game.keyDown).forEach(item => {
               if(game.keyDown[item] && o.action[item]) {
                  o.move(item, game);
               }
            })

         }
         return o;
      }
   </script>
</body>
</html>
